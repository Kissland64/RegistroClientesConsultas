@page "/RegistroClientes"
@page "/RegistroClientes/{ClienteId:int}"
@using System.ComponentModel.DataAnnotations
@inject ClientesBLL clientesBLL

<h3></h3>

<EditForm Model="cliente">
    
    <div class = "card">

        <div class = "card-header">
            <h1>Registro de clientes</h1>
        </div>
        <div class = "card-body">
        
            <div class="form-group">
                <label for="nombre">Nombre:</label>
                <input type="text" class="form-control" @bind="@cliente.Nombre" />
                <ValidationMessage For="@(() => cliente.Nombre)" />
            </div>
            <div class="form-group">
                <label for="telefono">Telefono:</label>
                <input type="text" class="form-control" @bind="@cliente.Telefono" />
                <ValidationMessage For="@(() => cliente.Telefono)" />
            </div>
            <div class="form-group">
                <label for="celular">Celular:</label>
                <input type="text" class="form-control" @bind="@cliente.Celular" />
                <ValidationMessage For="@(() => cliente.Celular)" />
            </div>
            <div class="form-group">
                <label for="rnc">RNC:</label>
                <input type="text" class="form-control" @bind="@cliente.RNC" />
                <ValidationMessage For="@(() => cliente.RNC)" />
            </div>
            <div class="form-group">
                <label for="email">Email:</label>
                <input type="email" class="form-control" @bind="@cliente.Email" />
                <ValidationMessage For="@(() => cliente.Email)" />
            </div>
            <div class="form-group">
                <label for="direccion">Direcci√≥n:</label>
                <input type="text" class="form-control" @bind="@cliente.Direccion" />
                <ValidationMessage For="@(() => cliente.Direccion)" />
    </div>

        </div>
        <div class="card-footer">
            <button type="button" class="btn btn-primary" @onclick="Nuevo">Nuevo</button>
            <button type="button" class="btn btn-success" @onclick="AgregarCliente">Agregar Cliente</button>
            <button type="button" class="btn btn-danger" @onclick="Eliminar">Eliminar cliente</button>
            
        </div>
    </div>


</EditForm>

@code {
    [Parameter]
    public int ClienteId { get; set; }
    private List<Clientes> clientes = new List<Clientes>();
    private Clientes cliente = new Clientes();

    private void AgregarCliente()
    {
        if (clientesBLL.Guardar(cliente)){
            Nuevo();
        }
    }

    private void Eliminar()
    {
        if (clientesBLL.Eliminar(cliente)){
            Nuevo();
        }
    }

    private void Nuevo()
    {
        cliente = new Clientes();
    }

    private bool ValidarCliente(Clientes cliente)
    {
        var context = new ValidationContext(cliente, serviceProvider: null, items: null);
        var results = new List<ValidationResult>();

        if (!Validator.TryValidateObject(cliente, context, results, validateAllProperties: true))
        {
            foreach (var validationResult in results)
            {
                Console.WriteLine(validationResult.ErrorMessage);
            }

            return false;
        }

        if (clientes.Any(c => c.Nombre == cliente.Nombre))
        {
            Console.WriteLine("Ya existe un cliente con el mismo nombre.");
            return false;
        }

        if (clientes.Any(c => c.RNC == cliente.RNC))
        {
            Console.WriteLine("Ya existe un cliente con el mismo RNC.");
            return false;
        }
        else
            return true;
    }
}
